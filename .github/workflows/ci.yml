name: CI
on:
  push:
      branches: [ main ]
        pull_request:
            branches: [ main ]
            jobs:
              build-test-deploy:
                  runs-on: ubuntu-latest
                      env:
                            NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
                                  NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
                                      steps:
                                            - uses: actions/checkout@v4
                                                  - uses: actions/setup-node@v4
                                                          with:
                                                                    node-version: 20
                                                                          - run: npm ci
                                                                                - uses: microsoft/playwright-github-action@v1
                                                                                      - run: npm test
                                                                                            - if: env.NETLIFY_AUTH_TOKEN != '' && env.NETLIFY_SITE_ID != ''
                                                                                                    run: npx netlify deploy --prod --dir=. --message "GitHub ${{ github.sha }}"
                                                                                                          - if: env.NETLIFY_AUTH_TOKEN != '' && env.NETLIFY_SITE_ID != ''
                                                                                                                  run: |
                                                                                                                            STATUS=$(curl -sS -o /dev/null -w "%{http_code}" https://$NETLIFY_SITE_ID.netlify.app)
                                                                                                                                      [ "$STATUS" = "200" ] || (echo "Smoke check failed"; exit 1)
                                                                                                                                      
